<%- include('partials/header') %>

<!-- SwiperJS CDN -->
<link rel="stylesheet" href="https://unpkg.com/swiper@10/swiper-bundle.min.css" />
<script src="https://unpkg.com/swiper@10/swiper-bundle.min.js"></script>

<style>
  /* Tinh ch·ªânh nh·ªè cho ph·∫ßn 'Kh√°m ph√° theo lo·∫°i ph√≤ng' */
  .discover-section { background:#f8fbff; padding:34px 0; }
  .discover-grid { display:flex; gap:28px; align-items:flex-start; }
  .discover-left { flex:1.2; }
  .discover-right { flex:1; display:flex; flex-direction:column; gap:14px; }
  .discover-img { width:100%; height:380px; object-fit:cover; border-radius:14px; box-shadow:0 12px 36px rgba(2,132,199,.08); transition:all .35s ease; }
  .type-chip { border-radius:999px; padding:.45rem .8rem; border:1px solid #c7e9ff; background:transparent; color:#0369a1; cursor:pointer; transition:.18s; }
  .type-chip.active { background:#0ea5e9; color:#fff; border-color:#0ea5e9; box-shadow:0 10px 28px rgba(14,165,233,.12); transform:translateY(-3px); }
  .type-card { background:#fff; padding:12px; border-radius:12px; box-shadow:0 10px 22px rgba(2,132,199,.04); display:flex; gap:12px; align-items:flex-start; transition:.18s; }
  .type-card:hover { transform:translateY(-6px); box-shadow:0 18px 40px rgba(2,132,199,.10); }
  .type-icon { width:56px; height:56px; border-radius:12px; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,#e6f7ff,#dbeafe); color:#0369a1; font-weight:700; }
  @media (max-width:980px) {
    .discover-grid { flex-direction:column; }
    .discover-img { height:220px; }
  }

  /* ===== Discounts styles embedded here so index loads correctly if css not updated yet ===== */
  .discounts-section {
    padding: 36px 0 18px;
    background: transparent;
  }
  .discounts-section .section-title {
    color: #1778ff;
    font-size: 26px;
    margin-bottom: 18px;
    font-weight: 700;
  }

  .discount-inner {
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .discount-code { font-size: 18px; font-weight:700; color:#0f6fa8; }
  /* s·ª≠a: ch·ªØ ph·∫ßn trƒÉm tr·∫Øng, ƒë·∫∑t n·ªÅn gradient */
  .discount-percent {
    background: linear-gradient(90deg,#00c3ff,#0078ff);
    color: #ffffff;
    font-size:14px;
    font-weight:800;
    padding: 8px 12px;
    border-radius: 8px;
    width: 72px;
    text-align: center;
  }
  .discount-dates { color:#6b7b85; font-size:13px; }
  .discount-cta { margin-top:10px; display:flex; justify-content:flex-end; }
  .btn-apply { cursor:pointer; padding:8px 12px; border-radius:6px; border:none; background:#0ea5e9; color:#fff; }
  .btn-apply:active { transform:translateY(1px); }
  .no-discounts { color:#6b7280; padding:12px 0; }


</style>

<!-- HERO BANNER SECTION -->
<section class="hero-banner" style="background-image: url('/images/banner1.jpg');">
  <div class="overlay"></div>
  <div class="hero-content container text-center text-white">
    <h1 class="fw-bold display-4 mb-3">T·∫≠n h∆∞·ªüng k·ª≥ ngh·ªâ ho√†n h·∫£o c√πng ch√∫ng t√¥i</h1>
    <p class="lead mb-4">ƒê·∫∑t ph√≤ng d·ªÖ d√†ng ‚Äì ∆Øu ƒë√£i h·∫•p d·∫´n ‚Äì Tr·∫£i nghi·ªám ƒë·∫≥ng c·∫•p</p>

    <!-- Search form -->
    <form action="/search" method="get" class="search-box row justify-content-center g-2 p-3 bg-white rounded-4 shadow-lg">
      <div class="col-md-3 col-12">
        <input class="form-control" type="text" name="q" placeholder="T·ª´ kh√≥a (Deluxe, D101, ...)" />
      </div>
      <div class="col-md-2 col-6">
        <select class="form-select" name="type">
          <option value="">T·∫•t c·∫£ lo·∫°i ph√≤ng</option>
          <option value="Standard">Standard</option>
          <option value="Superior">Superior</option>
          <option value="Deluxe">Deluxe</option>
          <option value="Suite">Suite</option>
        </select>
      </div>
      <div class="col-md-2 col-6">
        <input class="form-control" type="date" name="checkIn" placeholder="Nh·∫≠n ph√≤ng" />
      </div>
      <div class="col-md-2 col-6">
        <input class="form-control" type="date" name="checkOut" placeholder="Tr·∫£ ph√≤ng" />
      </div>
      <div class="col-md-2 col-6">
        <button type="submit" class="btn btn-accent w-100 fw-bold">T√¨m ph√≤ng</button>
      </div>
    </form>
  </div>
</section>


<!-- ======= ∆ØU ƒê√ÉI C·ª¶A CH√öNG T√îI ======= -->
<section class="discounts-section">
  <div class="container">
    <h2 class="section-title">∆Øu ƒë√£i c·ªßa ch√∫ng t√¥i</h2>

    <div class="swiper discount-swiper">
      <div class="swiper-wrapper">
        <% discounts.forEach(discount => { %>
          <div class="swiper-slide">
            <div class="discount-card">
              <div class="discount-header">
                <span class="discount-percent"><%= discount.percent %>%</span>
                <% const valid = new Date() <= new Date(discount.endDate); %>
                <% if (valid) { %>
                  <span class="discount-status active">C√≤n hi·ªáu l·ª±c</span>
                <% } else { %>
                  <span class="discount-status expired">H·∫øt h·∫°n</span>
                <% } %>
              </div>
              <p class="discount-code">M√£: <%= discount.code %></p>
              <p class="discount-date">
                T·ª´ <%= discount.startDate.toLocaleDateString('vi-VN') %> -
                <%= discount.endDate.toLocaleDateString('vi-VN') %>
              </p>
              <button class="copy-btn" onclick="copyCode('<%= discount.code %>')">Sao ch√©p m√£</button>
            </div>
          </div>
        <% }) %>
      </div>

      <!-- N√∫t ƒëi·ªÅu h∆∞·ªõng -->
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div>
  </div>
</section>

<!-- Swiper setup -->
<script>
  window.addEventListener("load", () => {
    new Swiper(".discount-swiper", {
      slidesPerView: 3,
      spaceBetween: 40,
      grabCursor: true,
      loop: false,
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
      breakpoints: {
        0: { slidesPerView: 1 },
        768: { slidesPerView: 2 },
        1200: { slidesPerView: 3 },
      },
    });
  });

  function copyCode(code) {
    navigator.clipboard.writeText(code);
    alert("ƒê√£ sao ch√©p m√£: " + code);
  }
</script>


<!-- Kh√°m ph√° theo lo·∫°i ph√≤ng -->
<section class="discover-section container my-5">
  <h3 class="section-title mb-4">Kh√°m ph√° theo lo·∫°i ph√≤ng</h3>

  <div class="discover-container">
    <!-- C·ªôt ·∫£nh b√™n tr√°i -->
    <div class="discover-left text-center">
  <img id="roomImage" src="" alt="·∫¢nh lo·∫°i ph√≤ng" class="room-preview hidden">
  <div id="viewAllContainer" class="hidden">
    <a id="viewAllButton" href="#" class="btn btn-outline-primary btn-sm mt-3 rounded-pill">
      Xem t·∫•t c·∫£ ph√≤ng
    </a>
  </div>
</div>

    <!-- C·ªôt n·ªôi dung b√™n ph·∫£i -->
    <div class="discover-right">

      <div class="room-type-card" data-type="standard">
        <div class="room-type-header">
          <div class="type-left">
            <div class="type-icon">S</div>
            <div>
              <h5>Standard <span class="badge bg-light text-dark fw-normal">H·∫°ng c∆° b·∫£n</span></h5>
              <p class="text-muted small mb-0">H·∫°ng c∆° b·∫£n, di·ªán t√≠ch v·ª´a ph·∫£i, ti·ªán nghi ti√™u chu·∫©n. Ph√π h·ª£p cho kh√°ch mu·ªën ti·∫øt ki·ªám.</p>
            </div>
          </div>
          <button class="toggle-btn"><i class="bi bi-chevron-down"></i></button>
        </div>
        <div class="room-type-body">
          <ul>
            <li>Di·ªán t√≠ch: 25‚Äì30m¬≤</li>
            <li>Gi∆∞·ªùng: 1 Queen ho·∫∑c 2 Single</li>
            <li>Ti·ªán nghi: Wifi, TV, m√°y l·∫°nh, minibar...</li>
          </ul>
        </div>
      </div>

      <div class="room-type-card" data-type="superior">
        <div class="room-type-header">
          <div class="type-left">
            <div class="type-icon">SP</div>
            <div>
              <h5>Superior <span class="badge bg-light text-dark fw-normal">H·∫°ng trung</span></h5>
              <p class="text-muted small mb-0">Ph√≤ng r·ªông h∆°n, trang tr√≠ ƒë·∫πp, ph√π h·ª£p kh√°ch c√¥ng t√°c v√† c·∫∑p ƒë√¥i.</p>
            </div>
          </div>
          <button class="toggle-btn"><i class="bi bi-chevron-down"></i></button>
        </div>
        <div class="room-type-body">
          <ul>
            <li>Di·ªán t√≠ch: 35‚Äì40m¬≤</li>
            <li>Gi∆∞·ªùng: 1 King ho·∫∑c 2 Twin</li>
            <li>Ti·ªán nghi: B√†n l√†m vi·ªác, view th√†nh ph·ªë, b·ªìn t·∫Øm...</li>
          </ul>
        </div>
      </div>

      <div class="room-type-card" data-type="deluxe">
        <div class="room-type-header">
          <div class="type-left">
            <div class="type-icon">DX</div>
            <div>
              <h5>Deluxe <span class="badge bg-light text-dark fw-normal">H·∫°ng cao</span></h5>
              <p class="text-muted small mb-0">View ƒë·∫πp, n·ªôi th·∫•t cao c·∫•p h∆°n, ph√π h·ª£p kh√°ch du l·ªãch mu·ªën tr·∫£i nghi·ªám.</p>
            </div>
          </div>
          <button class="toggle-btn"><i class="bi bi-chevron-down"></i></button>
        </div>
        <div class="room-type-body">
          <ul>
            <li>Di·ªán t√≠ch: 40‚Äì50m¬≤</li>
            <li>Gi∆∞·ªùng: 1 King</li>
            <li>Ti·ªán nghi: Ban c√¥ng, sofa, m√°y pha c√† ph√™...</li>
          </ul>
        </div>
      </div>

      <div class="room-type-card" data-type="suite">
        <div class="room-type-header">
          <div class="type-left">
            <div class="type-icon">ST</div>
            <div>
              <h5>Suite <span class="badge bg-light text-dark fw-normal">H·∫°ng sang</span></h5>
              <p class="text-muted small mb-0">Ph√≤ng sang tr·ªçng, c√≥ ph√≤ng kh√°ch ri√™ng v√† d·ªãch v·ª• cao c·∫•p.</p>
            </div>
          </div>
          <button class="toggle-btn"><i class="bi bi-chevron-down"></i></button>
        </div>
        <div class="room-type-body">
          <ul>
            <li>Di·ªán t√≠ch: 70‚Äì100m¬≤</li>
            <li>Gi∆∞·ªùng: 1 King</li>
            <li>Ti·ªán nghi: Ph√≤ng kh√°ch ri√™ng, view to√†n c·∫£nh...</li>
          </ul>
        </div>
      </div>

    </div>
  </div>
</section>


<!-- Featured rooms (enhanced with booking status badges + view buttons) -->
<section class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="text-primary fw-bold mb-0">Ph√≤ng n·ªïi b·∫≠t</h3>
  <div>
    <button id="btnShowAll" class="btn btn-primary btn-sm me-2">Xem t·∫•t c·∫£ ph√≤ng</button>
    <button id="btnShowAvailable" class="btn btn-success btn-sm">Ph√≤ng s·∫µn s√†ng</button>
  </div>
</div>


  <div class="row g-4">
    <% if (rooms && rooms.length) { %>
      <% rooms.forEach(function(r){ 
           // ‚úÖ X√°c ƒë·ªãnh ƒë∆∞·ªùng d·∫´n ·∫£nh
           let imgPath = '/images/room1.jpeg';
           if (r.image) {
             const img = String(r.image || '').trim();
             const isUrl = img.startsWith('http://') || img.startsWith('https://');
             if (isUrl) {
               imgPath = img;
             } else if (img.startsWith('/')) {
               imgPath = img;
             } else if (img.includes('/')) {
               imgPath = '/' + img;
             } else {
               imgPath = '/uploads/rooms/' + img;
             }
           }

           // ‚úÖ Ki·ªÉm tra tr·∫°ng th√°i ph√≤ng (∆∞u ti√™n c·ªù t·ª´ DB)
           const isBooked = !!r.isBooked; // true n·∫øu ph√≤ng ƒëang ƒë∆∞·ª£c ƒë·∫∑t
      %>
        <div class="col-sm-6 col-lg-4">
          <div class="card room-card h-100 border-0 shadow-sm rounded-4 position-relative <%= isBooked ? 'room-card-disabled' : '' %>">
            <img src="<%= imgPath %>" class="card-img-top rounded-top-4" style="height:220px;object-fit:cover" alt="room" onerror="this.src='/images/room1.jpeg'">
            <div class="card-body">
              <h6 class="fw-bold mb-1"><%= r.name || (r.type + ' - ' + r.roomNumber) %></h6>
              <div class="d-flex justify-content-between align-items-center">
                <div class="text-info fw-bold"><%= (r.price||0).toLocaleString() %>‚Ç´/ƒë√™m</div>
                <div class="small text-muted"><%= r.type || '' %></div>
              </div>
            </div>

            <div class="card-footer bg-transparent border-0 d-flex justify-content-between align-items-center">
              <div>
                <% if (isBooked) { %>
                  <span class="badge bg-danger">ƒê√£ c√≥ kh√°ch</span>
                <% } else { %>
                  <span class="badge bg-success">C√≤n tr·ªëng</span>
                <% } %>
              </div>

              <div>
                <% if (!isBooked) { %>
                  <a class="btn btn-primary btn-sm" href="/user/room/<%= r._id %>">Xem & ƒê·∫∑t</a>
                <% } else { %>
                  <button class="btn btn-secondary btn-sm" disabled>Kh√¥ng kh·∫£ d·ª•ng</button>
                <% } %>
              </div>
            </div>

          </div>
        </div>
      <% }) %>
    <% } else { %>
      <div class="col-12 text-muted text-center">Hi·ªán ch∆∞a c√≥ ph√≤ng kh·∫£ d·ª•ng.</div>
    <% } %>
  </div>
</section>

<%- include('partials/footer') %>

<script>
  document.addEventListener("DOMContentLoaded",function(){
    const imgs = {
      standard: '/images/Standard.jpg',
      superior: '/images/Superior.jpg',
      deluxe: '/images/Deluxe.jpg',
      suite: '/images/Suite.jpg'
    };
    document.querySelectorAll('.type-chip').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.type-chip').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const key = btn.dataset.key;
        const img = document.getElementById('discoverMainImg');
        if(img){
          img.style.opacity = 0;
          setTimeout(()=>{ img.src = imgs[key] || '/images/room-explore.jpg'; img.style.opacity = 1; }, 180);
        }
      });
    });

    const today = new Date().toISOString().split('T')[0];
    const inEl = document.getElementById('checkIn');
    const outEl = document.getElementById('checkOut');
    if(inEl) inEl.min = today;
    if(outEl) outEl.min = today;
    if(inEl && outEl) inEl.addEventListener('change', ()=> outEl.min = inEl.value || today);

    // Clipboard copy for discount codes
    document.addEventListener('click', function(e){
      const el = e.target;
      if (el && el.classList.contains('btn-apply')) {
        const code = el.getAttribute('data-code');
        if (!code) return;
        navigator.clipboard && navigator.clipboard.writeText(code).then(()=>{
          const old = el.innerText;
          el.innerText = 'ƒê√£ sao ch√©p';
          setTimeout(()=> el.innerText = old, 1400);
        }).catch(err=>{
          console.error('Copy failed', err);
          alert('Kh√¥ng th·ªÉ sao ch√©p t·ª± ƒë·ªông, vui l√≤ng sao ch√©p th·ªß c√¥ng: ' + code);
        });
      }
    });

    // SwiperJS init for discounts
new Swiper(".discount-swiper", {
  slidesPerView: 3,
  spaceBetween: 30,
  grabCursor: true,
  loop: false,
  navigation: {
    nextEl: ".swiper-button-next",
    prevEl: ".swiper-button-prev",
  },
  breakpoints: {
    0: { slidesPerView: 1 },
    768: { slidesPerView: 2 },
    1200: { slidesPerView: 3 },
  },
});
  });
</script>

<script>
  // üîπ Khi DOM ƒë√£ s·∫µn s√†ng
  document.addEventListener("DOMContentLoaded", () => {
    const allCards = document.querySelectorAll(".room-card");
    const btnAll = document.getElementById("btnShowAll");
    const btnAvailable = document.getElementById("btnShowAvailable");

    // ‚úÖ N√∫t hi·ªÉn th·ªã t·∫•t c·∫£ ph√≤ng
    btnAll.addEventListener("click", () => {
      allCards.forEach(card => {
        card.parentElement.style.display = "block";
      });
    });

    // ‚úÖ N√∫t hi·ªÉn th·ªã ch·ªâ ph√≤ng tr·ªëng
    btnAvailable.addEventListener("click", () => {
      allCards.forEach(card => {
        const isBooked = card.classList.contains("room-card-disabled");
        card.parentElement.style.display = isBooked ? "none" : "block";
      });
    });
  });
</script>

