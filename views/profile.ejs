<%- include('partials/header') %>

<div class="profile-container">
  <div class="profile-card shadow-lg border-0 rounded-4">
    <h2 class="fw-bold text-primary mb-2">Hồ sơ cá nhân</h2>
    <p class="text-muted mb-4">Cập nhật thông tin của bạn để sử dụng dịch vụ thuận tiện hơn.</p>

    <form action="/user/profile" method="POST" enctype="multipart/form-data">
      <!-- Avatar hiển thị -->
      <div class="avatar-wrapper position-relative mb-4">
        <img
          src="<%= data.avatar && data.avatar !== '' ? data.avatar : '/uploads/avatars/default-user.jpg' %>"
          alt="Avatar người dùng"
          class="avatar-preview shadow-sm"
          id="avatarPreview"
        />

        <!-- Nút thay avatar có icon máy ảnh -->
        <label for="avatar" class="change-avatar-btn d-flex justify-content-center align-items-center">
          <i class="bi bi-camera-fill"></i>
        </label>

        <input
          type="file"
          name="avatar"
          id="avatar"
          class="d-none"
          accept="image/*"
          onchange="previewAvatar(event)"
        />
      </div>

      <!-- Form thông tin -->
      <div class="form-row">
        <div class="form-group">
          <label for="name" class="fw-semibold">Họ và tên</label>
          <input
            type="text"
            name="name"
            value="<%= data?.name || '' %>"
            placeholder="Họ và tên"
            class="form-control rounded-3 shadow-sm"
          />
        </div>
        <div class="form-group">
          <label for="cccd" class="fw-semibold">CCCD / CMND</label>
          <input
            type="text"
            name="cccd"
            value="<%= data?.cccd || '' %>"
            placeholder="CCCD / CMND"
            class="form-control rounded-3 shadow-sm"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="email" class="fw-semibold">Email</label>
          <input
            type="email"
            name="email"
            value="<%= data?.email || '' %>"
            placeholder="Email"
            class="form-control rounded-3 shadow-sm"
            readonly
          />
        </div>
        <div class="form-group">
          <label for="phone" class="fw-semibold">Số điện thoại</label>
          <input
            type="text"
            name="phone"
            value="<%= data?.phone || '' %>"
            placeholder="Số điện thoại"
            class="form-control rounded-3 shadow-sm"
          />
        </div>
      </div>

      <% if (success) { %>
        <div class="alert alert-success py-2 rounded-3 mt-3"><%= success %></div>
      <% } %>
      <% if (error) { %>
        <div class="alert alert-danger py-2 rounded-3 mt-3"><%= error %></div>
      <% } %>

      <button type="submit" class="btn btn-primary w-100 mt-3 rounded-3 fw-semibold shadow-sm save-btn">
        <i class="bi bi-save-fill me-2"></i> Lưu thay đổi
      </button>
    </form>
  </div>
</div>

<%- include('partials/footer') %>

<!-- JS xem trước ảnh -->
<script>
  function previewAvatar(event) {
    const reader = new FileReader();
    reader.onload = function () {
      document.getElementById("avatarPreview").src = reader.result;
    };
    reader.readAsDataURL(event.target.files[0]);
  }
</script>

<!-- Bootstrap Icons (bắt buộc để hiển thị icon máy ảnh) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<!-- CSS -->
<style>
  .profile-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 80vh;
    background: #f9fcff;
  }

  .profile-card {
    background: #fff;
    padding: 2.5rem;
    width: 100%;
    max-width: 650px;
    text-align: center;
    border-radius: 15px;
  }

  /* Avatar */
  .avatar-wrapper {
    display: flex;
    justify-content: center;
    position: relative;
  }

  .avatar-preview {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid #007bff;
    transition: 0.3s;
  }

  .avatar-preview:hover {
    filter: brightness(0.9);
  }

  .change-avatar-btn {
    position: absolute;
    bottom: 4px;
    right: 42%;
    width: 36px;
    height: 36px;
    background: #fff;
    border: 2px solid #007bff;
    border-radius: 50%;
    cursor: pointer;
    transition: 0.3s ease;
  }

  .change-avatar-btn i {
    color: #007bff;
    font-size: 1.2rem;
  }

  .change-avatar-btn:hover {
    background: #007bff;
    transform: scale(1.1);
  }

  .change-avatar-btn:hover i {
    color: #fff;
  }

  /* Form */
  .form-row {
    display: flex;
    gap: 15px;
  }

  .form-group {
    flex: 1;
    text-align: left;
    margin-bottom: 1rem;
  }

  .form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 8px rgba(0, 123, 255, 0.3);
  }

  /* Nút lưu */
  .save-btn {
    transition: all 0.25s ease;
  }

  .save-btn:hover {
    transform: translateY(-2px);
    background-color: #0056b3;
  }

  @media (max-width: 600px) {
    .form-row {
      flex-direction: column;
    }
  }
</style>
