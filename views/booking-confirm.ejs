<%- include('partials/header') %>
<% if (status === 'success' || booking.status === 'paid') { %>
  <div class="alert alert-success text-center">üéâ Thanh to√°n MoMo th√†nh c√¥ng!</div>
<% } else if (status === 'failed') { %>
  <div class="alert alert-danger text-center">‚ùå Thanh to√°n th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i.</div>
<% } else if (status === 'error') { %>
  <div class="alert alert-warning text-center">‚ö†Ô∏è C√≥ l·ªói x·∫£y ra khi x·ª≠ l√Ω thanh to√°n.</div>
<% } %>

<div class="container mt-5 pt-5">
  <div class="row justify-content-center">
    <div class="col-md-9">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
          <h4 class="mb-0">X√°c Nh·∫≠n ƒê·∫∑t Ph√≤ng</h4>
          <span class="badge bg-light text-dark">Tr·∫°ng th√°i: <%= booking.status || 'pending' %></span>
        </div>

        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <p><strong>Ph√≤ng:</strong> <%= booking.roomId.roomNumber %> - <%= booking.roomId.type %></p>
              <p><strong>M√¥ t·∫£:</strong> <%= booking.roomId.description || '‚Äî' %></p>
              <p><strong>Check-in:</strong> <%= new Date(booking.checkIn).toLocaleDateString('vi-VN') %></p>
              <p><strong>Check-out:</strong> <%= new Date(booking.checkOut).toLocaleDateString('vi-VN') %></p>
            </div>

            <div class="col-md-6">
              <p><strong>S·ªë ƒë√™m:</strong> <%= Math.max(1, Math.round((new Date(booking.checkOut) - new Date(booking.checkIn)) / (1000*60*60*24))) %></p>
              <p><strong>Gi√°/ƒë√™m:</strong> <%= (booking.roomId.price || 0).toLocaleString('vi-VN') %> ƒë</p>
              <% if (booking.discountApplied) { %>
                <p class="text-success"><strong>Gi·∫£m gi√°:</strong> -<%= (booking.discountApplied || 0).toLocaleString('vi-VN') %> ƒë</p>
              <% } %>
              <h4 class="text-danger"><strong>T·ªïng c·ªông: <%= (booking.totalPrice || 0).toLocaleString('vi-VN') %> ƒë</strong></h4>
            </div>
          </div>

          <hr>

          <div class="text-center">
            <% if (booking.status === 'paid' || booking.status === 'confirmed') { %>
              <a class="btn btn-success btn-lg" href="/user/history">Xem l·ªãch s·ª≠ & chi ti·∫øt</a>
            <% } else { %>
              <!-- chuy·ªÉn sang trang payment hi·ªÉn th·ªã QR (momo / vnpay) -->
              <a class="btn btn-success btn-lg" href="/payment/user?bookingId=<%= booking._id %>">Thanh To√°n Ngay</a>
              <a href="/" class="btn btn-secondary btn-lg">Quay v·ªÅ</a>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<%- include('partials/footer') %>
